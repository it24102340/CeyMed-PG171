<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - CeyMed Insurance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .admin-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem 0; margin-bottom: 2rem; }
        .policy-card { transition: transform 0.3s ease; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);} 
        .policy-card:hover { transform: translateY(-2px); }
        .btn-primary { background: linear-gradient(45deg, #667eea, #764ba2); border: none; }
        .btn-primary:hover { background: linear-gradient(45deg, #5a6fd8, #6a4190); }
        .btn-danger { background: linear-gradient(45deg, #dc3545, #c82333); border: none; }
        .btn-success { background: linear-gradient(45deg, #28a745, #218838); border: none; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/"><i class="fas fa-shield-alt me-2"></i>CeyMed Insurance - Admin</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link active" href="/policy/admin">Policies</a></li>
                    <li class="nav-item"><a class="nav-link" href="/purchase/admin/stop-requests">Stop Requests</a></li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"><i class="fas fa-user-shield me-1"></i>Admin</a>
                        <ul class="dropdown-menu"><li><a class="dropdown-item" href="/user/logout">Logout</a></li></ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="admin-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8"><h1 class="fw-bold mb-2"><i class="fas fa-cogs me-2"></i>Admin Panel</h1><p class="mb-0">Manage insurance policies and user requests</p></div>
                <div class="col-md-4 text-md-end"><button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#addPolicyModal"><i class="fas fa-plus me-2"></i>Add New Policy</button></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert"><i class="fas fa-check-circle me-2"></i><span th:text="${successMessage}"></span><button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert"><i class="fas fa-exclamation-circle me-2"></i><span th:text="${errorMessage}"></span><button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>

        <div class="card"><div class="card-header"><h5 class="mb-0"><i class="fas fa-list me-2"></i>All Policies</h5></div>
            <div class="card-body"><div class="table-responsive">
                <table class="table table-hover"><thead><tr><th>ID</th><th>Policy Name</th><th>Category</th><th>Coverage</th><th>Premium</th><th>Duration</th><th>Monthly Cost</th><th>Start Date</th><th>End Date</th><th>Actions</th></tr></thead>
                    <tbody><tr th:each="policy : ${policies}"><td th:text="${policy.policyId}">1</td><td th:text="${policy.policyName}">Policy</td>
                        <td><span class="badge" th:classappend="${policy.category == 'Premium'} ? 'bg-warning' : (${policy.category == 'Gold'} ? 'bg-success' : 'bg-secondary')" th:text="${policy.category}">Category</span></td>
                        <td th:text="${policy.coverage}">0.00</td><td th:text="${policy.premium}">0.00</td><td th:text="${policy.duration} + ' months'">0 months</td><td class="fw-bold text-primary" th:text="${policy.monthlyCost}">0.00</td><td th:text="${policy.startDate}">2024-01-01</td><td th:text="${policy.endDate}">2024-12-31</td>
                        <td><div class="btn-group" role="group"><button class="btn btn-sm btn-outline-primary" th:onclick="'editPolicy(' + ${policy.policyId} + ')' "><i class="fas fa-edit"></i></button><button class="btn btn-sm btn-outline-danger" th:onclick="'deletePolicy(' + ${policy.policyId} + ')' "><i class="fas fa-trash"></i></button></div></td></tr></tbody>
                </table></div></div>
        </div>
    </div>

    <div class="modal fade" id="addPolicyModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title"><i class="fas fa-plus me-2"></i>Add New Policy</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <form th:action="@{/policy/admin/create}" th:object="${policyDto}" method="post">
            <div class="modal-body"><div class="row"><div class="col-md-6 mb-3"><label for="policyName" class="form-label">Policy Name</label><input type="text" class="form-control" id="policyName" th:field="*{policyName}" required></div>
                <div class="col-md-6 mb-3"><label for="category" class="form-label">Category</label><select class="form-select" id="category" th:field="*{category}" required><option value="">Select Category</option><option value="Premium">Premium</option><option value="Gold">Gold</option><option value="Silver">Silver</option></select></div></div>
                <div class="row"><div class="col-md-6 mb-3"><label for="coverage" class="form-label">Coverage</label><input type="number" class="form-control" id="coverage" th:field="*{coverage}" step="0.01" min="0" required></div>
                    <div class="col-md-6 mb-3"><label for="premium" class="form-label">Premium</label><input type="number" class="form-control" id="premium" th:field="*{premium}" step="0.01" min="0" required></div></div>
                <div class="row"><div class="col-md-6 mb-3"><label for="startDate" class="form-label">Start Date</label><input type="date" class="form-control" id="startDate" th:field="*{startDate}" required></div>
                    <div class="col-md-6 mb-3"><label for="endDate" class="form-label">End Date</label><input type="date" class="form-control" id="endDate" th:field="*{endDate}" required></div></div>
                <div class="mb-3"><label for="duration" class="form-label">Duration (months)</label><input type="number" class="form-control" id="duration" th:field="*{duration}" min="1" required></div>
            </div>
            <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="submit" class="btn btn-primary"><i class="fas fa-save me-1"></i>Create Policy</button></div>
        </form>
    </div></div></div>

    <div class="modal fade" id="editPolicyModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Policy</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <form id="editPolicyForm" method="post">
            <div class="modal-body"><div class="row"><div class="col-md-6 mb-3"><label for="editPolicyName" class="form-label">Policy Name</label><input type="text" class="form-control" id="editPolicyName" name="policyName" required></div>
                <div class="col-md-6 mb-3"><label for="editCategory" class="form-label">Category</label><select class="form-select" id="editCategory" name="category" required><option value="Premium">Premium</option><option value="Gold">Gold</option><option value="Silver">Silver</option></select></div></div>
                <div class="row"><div class="col-md-6 mb-3"><label for="editCoverage" class="form-label">Coverage</label><input type="number" class="form-control" id="editCoverage" name="coverage" step="0.01" min="0" required></div>
                    <div class="col-md-6 mb-3"><label for="editPremium" class="form-label">Premium</label><input type="number" class="form-control" id="editPremium" name="premium" step="0.01" min="0" required></div></div>
                <div class="row"><div class="col-md-6 mb-3"><label for="editStartDate" class="form-label">Start Date</label><input type="date" class="form-control" id="editStartDate" name="startDate" required></div>
                    <div class="col-md-6 mb-3"><label for="editEndDate" class="form-label">End Date</label><input type="date" class="form-control" id="editEndDate" name="endDate" required></div></div>
                <div class="mb-3"><label for="editDuration" class="form-label">Duration (months)</label><input type="number" class="form-control" id="editDuration" name="duration" min="1" required></div>
            </div>
            <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="submit" class="btn btn-primary"><i class="fas fa-save me-1"></i>Update Policy</button></div>
        </form>
    </div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function editPolicy(policyId){ document.getElementById('editPolicyForm').action = '/policy/admin/update/' + policyId; const modal = new bootstrap.Modal(document.getElementById('editPolicyModal')); modal.show(); }
        function deletePolicy(policyId){ if(confirm('Delete policy '+policyId+'?')){ const form = document.createElement('form'); form.method='POST'; form.action='/policy/admin/delete/'+policyId; document.body.appendChild(form); form.submit(); } }
    </script>
</body>
</html>


